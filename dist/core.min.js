var app,$$,mainView;window.onload=function(){modeCordova?(document.addEventListener("deviceready",bootstrap.init),document.addEventListener("offline",internet.offline),document.addEventListener("online",internet.online)):bootstrap.init()};var bootstrap={};bootstrap.sessionID="",bootstrap.settings={},bootstrap.f7settings={},bootstrap.init=function(){void 0===window.overrideSettings&&(window.overrideSettings={}),void 0===window.overrideF7Settings&&(window.overrideF7Settings={}),bootstrap.settings=Object.assign({versionAPI:1,authType:"email",pageAfterAuth:"/home",marketiOS:"https://itunes.apple.com/us/app/lemurro/id0000000000?l=ru&ls=1&mt=8",marketAndroid:"market://details?id=ru.bestion.lemurro",onLoad:function(e){var t=Template7.compile($$("#js-tpl-user__info").html());$$("#js-user_info").html(t(e))}},window.overrideSettings),bootstrap.f7settings=Object.assign({id:"ru.bestion.lemurro",name:"Lemurro",version:"0.1.0",theme:"md",root:"#app",panel:{swipe:"both"},touch:{fastClicks:!1},on:{pageInit:function(e){app.panel.close(),bootstrap._initPage(e.name)}},routes:[{path:"/about",url:"./pages/about.html"},{path:"/home",url:"./pages/home.html"}]},window.overrideF7Settings),bootstrap._bindJSerrors(),app=new Framework7(bootstrap.f7settings),$$=Dom7,mainView=app.views.create(".view-main"),$$("#js-api-version").text(bootstrap.settings.versionAPI),bootstrap._showLoginScreen(),app.request.setup({cache:!1,crossDomain:!0,timeout:2e4,beforeSend:function(e){e.requestUrl.substr(0,pathServerAPI.length)===pathServerAPI&&(e.requestParameters.dataType="json",e.setRequestHeader("X-SESSION-ID",bootstrap.sessionID))},error:function(e,t){app.preloader.hide();var o="Неизвестная ошибка";switch(t){case"timeout":o="Время ожидания истекло";break;case"parsererror":o="Ошибка парсера";break;case"abort":o="Запрос был отменён";break;case"error":o="Произошла ошибка сервера"}app.dialog.alert(o,"Ошибка запроса")}}),bootstrap._run()},bootstrap._bindCodeMask=function(){$$(".js-code-mask").each(function(){var e=$$(this);Inputmask({mask:"9999"}).mask(e)})},bootstrap._bindExternalLink=function(){$$(document).on("click",'a[target="_blank"]',function(e){return window.open($$(this).attr("href"),"_system"),e.preventDefault(),!1})},bootstrap._bindJSerrors=function(){function e(e,t,o,r,n){var a="JSON not found";window.JSON&&(a=JSON.stringify(n)),"object"==typeof e&&(t=e.filename,o=e.lineno,r=e.colno,a=e.error.stack,e=e.message),(new Image).src=pathServerAPI+"jserrors?msg="+encodeURIComponent(e)+"&file="+encodeURIComponent(t)+"&line="+encodeURIComponent(o)+"&col="+encodeURIComponent(r)+"&err="+encodeURIComponent(a)}window.addEventListener?window.addEventListener("error",e,!1):window.attachEvent?window.attachEvent("onerror",e):window.onerror=e},bootstrap._bindPhoneMask=function(){$$(".js-phone-mask").each(function(){var e=$$(this);Inputmask({mask:"+7 (999) 999-99-99"}).mask(e)})},bootstrap._bindShowPopover=function(){$$("body").on("click",".js-show-popover",function(){app.dialog.alert($$(this).attr("data-popover"),"")})},bootstrap._initPage=function(e){app.preloader.show(),app.request.get(pathServerAPI+"user",{},function(t){if(app.preloader.hide(),t.hasOwnProperty("errors"))bootstrap.showErrors(t.errors);else{bootstrap.settings.onLoad(t.data);var o=window[e];void 0!==o&&o.hasOwnProperty("init")&&o.init()}})},bootstrap._run=function(){app.preloader.show(),app.request.get(pathServerAPI,{},function(e){if(app.preloader.hide(),e.hasOwnProperty("errors"))bootstrap.showErrors(e.errors);else if(modeCordova&&parseInt(e.data.version[device.platform.toLowerCase()],10)>bootstrap.settings.versionAPI){var t=$$("#js-popup");t.find(".popup__title").html("&nbsp;"),t.find(".popup__content").html('<div class="text-align-center"><h1><i class="fas fa-thumbs-up font-100"></i></h1><h1>Ура, вышла новая версия приложения!</h1><h3>Чтобы продолжить, обновите приложение из магазина.</h3><p><a href="javascript:bootstrap.update();" class="button button-raised button-fill">Обновить</a></p></div>'),t.find(".close-popup").hide(),app.popup.open(t)}else bootstrap._bindShowPopover(),bootstrap._bindPhoneMask(),bootstrap._bindCodeMask(),bootstrap._bindExternalLink(),localforage.getItem("sessionID",function(e,t){bootstrap.sessionID=t,null!==bootstrap.sessionID&&auth.check()})})},bootstrap._showLoginScreen=function(){$$("#js-login-screen .js-auth-form").hide(),$$("#js-auth-"+bootstrap.settings.authType+"-get-form").show(),app.loginScreen.open("#js-login-screen")},bootstrap.showErrors=function(e){if(1===e.length&&"401 Unauthorized"===e[0].status)bootstrap._showLoginScreen();else for(var t in e){var o=e[t],r="";switch(o.code){case"danger":r="Критическая ошибка";break;case"warning":r="Внимание!";break;case"info":r="Информация"}app.dialog.alert(o.title,r)}},bootstrap.update=function(){var t="market"+device.platform;return modeCordova&&bootstrap.settings.hasOwnProperty(t)?(window.open(bootstrap.settings[t],"_system"),e.preventDefault()):app.dialog.alert('Здесь должна быть ссылка на магазин "'+device.platform+'"',"Магазин"),!1};var auth={};auth._timerID=null,auth._runTimer=function(){null!==auth._timerID&&clearInterval(auth._timerID),auth._timerID=setInterval(function(){var e=$$("#js-auth-"+bootstrap.settings.authType+"-check-form"),t=e.find(".js-timer__count"),o=parseInt(t.text(),10);o>0?t.text(--o):(clearInterval(auth._timerID),e.find(".js-timer").hide(),e.find(".js-resend").show())},1e3)},auth.check=function(){app.preloader.show(),app.request.get(pathServerAPI+"auth/check",{},function(e){app.preloader.hide(),e.hasOwnProperty("errors")?(localforage.clear(),bootstrap.sessionID=""):(app.loginScreen.close("#js-login-screen"),app.router.navigate(bootstrap.settings.pageAfterAuth))})},auth.checkCode=function(){var e={uuid:"q1w2e3r4t5y6u7i8o9p0",platform:"TestOS",version:"1.0",manufacturer:"Samsung",model:"Galaxy S8"};modeCordova&&(e={uuid:device.uuid,platform:device.platform,version:device.version,manufacturer:device.manufacturer,model:device.model}),app.preloader.show(),app.request.post(pathServerAPI+"auth/code",{auth_id:$$("#js-auth-"+bootstrap.settings.authType+"-get-form").find('input[name="auth_id"]').val(),auth_code:$$("#js-auth-"+bootstrap.settings.authType+"-check-form").find('input[name="auth_code"]').val(),device_info:e},function(e){app.preloader.hide(),e.hasOwnProperty("errors")?bootstrap.showErrors(e.errors):localforage.setItem("sessionID",e.data.session,function(){Deferred.next(function(){bootstrap.sessionID=e.data.session}).next(function(){app.loginScreen.close("#js-login-screen"),app.router.navigate(bootstrap.settings.pageAfterAuth)})})})},auth.getCode=function(){app.preloader.show(),app.request.get(pathServerAPI+"auth/code",{auth_id:$$("#js-auth-"+bootstrap.settings.authType+"-get-form").find('input[name="auth_id"]').val()},function(e){if(app.preloader.hide(),e.hasOwnProperty("errors"))bootstrap.showErrors(e.errors);else{var t=$$("#js-auth-"+bootstrap.settings.authType+"-check-form");t.find(".js-timer").show(),t.find(".js-timer__count").text("60"),t.find(".js-resend").hide(),auth._runTimer(),$$("#js-auth-"+bootstrap.settings.authType+"-get-form").hide(),t.show()}})};var helper={};helper.showConfirm=function(e,t,o,r,n,a,s,i){swal({title:e,html:t,type:"",allowOutsideClick:!1,showCancelButton:!0,confirmButtonColor:"#2196f3",confirmButtonText:o,cancelButtonText:r,onOpen:n,preConfirm:a}).then(function(){s()},function(e){""!==e&&null!==i&&i()})},helper.showPopup=function(e,t){var o=$$("#js-popup");o.find(".popup__title").html(e),o.find(".popup__content").html(t),app.popup.open(o)};var internet={};internet.offline=function(){app.dialog.preloader("Пропал интернет,<br>надо вернуть.")},internet.showPopup=function(){app.dialog.close()};